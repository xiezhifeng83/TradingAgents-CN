# TradingAgents-CN 数据字典

> **文档版本**: v1.0
> **项目版本**: v1.0.0-preview
> **编制日期**: 2026-02-11

---

## 1. MongoDB 集合定义

### 1.1 用户表 (users)

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| _id | ObjectId | 是 | 自动生成 | 主键 |
| username | String | 是 | - | 用户名（唯一） |
| email | String | 是 | - | 邮箱地址（唯一） |
| password_hash | String | 是 | - | bcrypt哈希密码 |
| role | String | 是 | "user" | 角色：admin / user |
| is_active | Boolean | 是 | true | 是否激活 |
| created_at | DateTime | 是 | 当前时间 | 创建时间 |
| updated_at | DateTime | 是 | 当前时间 | 更新时间 |
| last_login | DateTime | 否 | null | 最后登录时间 |

### 1.2 分析任务表 (analysis_tasks)

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| _id | ObjectId | 是 | 自动生成 | 主键 |
| user_id | ObjectId | 是 | - | 关联用户ID |
| ticker | String | 是 | - | 股票代码 |
| company_name | String | 否 | - | 公司名称 |
| market_type | String | 是 | - | 市场类型：A股/港股/美股 |
| status | String | 是 | "pending" | 状态：pending/running/completed/failed |
| config | Object | 是 | - | 分析配置（见1.2.1） |
| result | Object | 否 | null | 分析结果（见1.2.2） |
| created_at | DateTime | 是 | 当前时间 | 创建时间 |
| started_at | DateTime | 否 | null | 开始分析时间 |
| completed_at | DateTime | 否 | null | 完成时间 |
| error_message | String | 否 | null | 错误信息 |

#### 1.2.1 config 子文档

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| llm_provider | String | LLM提供商 |
| deep_think_model | String | 深度思考模型名 |
| quick_think_model | String | 快速思考模型名 |
| max_debate_rounds | Integer | 辩论轮数上限 |
| max_risk_discuss_rounds | Integer | 风险讨论轮数上限 |
| online_tools | Boolean | 是否启用在线工具 |
| online_news | Boolean | 是否启用在线新闻 |

#### 1.2.2 result 子文档

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| market_report | String | 市场分析报告 |
| fundamentals_report | String | 基本面分析报告 |
| news_report | String | 新闻分析报告 |
| sentiment_report | String | 情绪分析报告 |
| bull_report | String | 看涨研究报告 |
| bear_report | String | 看跌研究报告 |
| investment_plan | String | 投资计划 |
| risk_assessment | String | 风险评估 |
| final_decision | String | 最终投资决策文本 |
| action | String | 操作建议：买入/持有/卖出 |
| confidence | Float | 置信度 (0.0-1.0) |
| target_price | Float | 目标价位（可选） |
| stop_loss | Float | 止损价位（可选） |

### 1.3 股票基础数据表 (stocks)

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| _id | ObjectId | 是 | 自动生成 | 主键 |
| code | String | 是 | - | 股票代码（唯一） |
| name | String | 是 | - | 股票名称 |
| market | String | 是 | - | 市场：A股/港股/美股 |
| exchange | String | 否 | - | 交易所：SH/SZ/HK/NYSE/NASDAQ |
| industry | String | 否 | - | 行业分类 |
| sector | String | 否 | - | 板块分类 |
| list_date | String | 否 | - | 上市日期 |
| status | String | 是 | "正常" | 状态：正常/退市/停牌 |
| updated_at | DateTime | 是 | 当前时间 | 更新时间 |

### 1.4 配置表 (configurations)

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| _id | ObjectId | 是 | 主键 |
| config_type | String | 是 | 配置类型：llm/datasource/system |
| config_data | Object | 是 | 配置数据（JSON） |
| updated_by | ObjectId | 否 | 修改人 |
| updated_at | DateTime | 是 | 修改时间 |

### 1.5 操作日志表 (operation_logs)

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| _id | ObjectId | 是 | 主键 |
| user_id | ObjectId | 否 | 操作用户 |
| action | String | 是 | 操作动作 |
| resource | String | 是 | 操作资源 |
| method | String | 是 | HTTP方法 |
| path | String | 是 | 请求路径 |
| status_code | Integer | 是 | 响应状态码 |
| ip_address | String | 否 | 客户端IP |
| created_at | DateTime | 是 | 操作时间（TTL: 30天） |

### 1.6 模拟交易表 (paper_trades)

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| _id | ObjectId | 是 | 主键 |
| user_id | ObjectId | 是 | 用户ID |
| ticker | String | 是 | 股票代码 |
| action | String | 是 | 操作：buy/sell |
| quantity | Integer | 是 | 数量 |
| price | Float | 是 | 成交价格 |
| total_amount | Float | 是 | 总金额 |
| created_at | DateTime | 是 | 交易时间 |

---

## 2. Redis 缓存键定义

### 2.1 数据缓存

| Key 模式 | 数据类型 | TTL | 说明 |
|---------|---------|-----|------|
| `market:{ticker}:{depth}` | Hash | 5 min | 市场行情数据 |
| `fundamentals:{ticker}` | Hash | 24 hour | 基本面财务数据 |
| `news:{ticker}:{days}` | String (JSON) | 30 min | 新闻数据 |
| `sentiment:{ticker}` | String (JSON) | 1 hour | 情绪数据 |
| `stock_info:{code}` | Hash | 7 day | 股票基础信息 |
| `stock_list:{market}` | String (JSON) | 24 hour | 股票列表 |

### 2.2 会话与安全

| Key 模式 | 数据类型 | TTL | 说明 |
|---------|---------|-----|------|
| `session:{user_id}` | String | 24 hour | 用户会话 |
| `rate_limit:{ip}:{endpoint}` | Counter | 1 min | API速率限制 |
| `blacklist:{token_jti}` | String | Token有效期 | Token黑名单 |

### 2.3 任务状态

| Key 模式 | 数据类型 | TTL | 说明 |
|---------|---------|-----|------|
| `task:{task_id}:status` | String | 24 hour | 分析任务状态 |
| `task:{task_id}:progress` | Hash | 24 hour | 分析进度详情 |
| `queue:analysis:length` | Counter | 无 | 队列长度 |

---

## 3. 智能体状态数据结构

### 3.1 AgentState（核心状态）

| 字段名 | 数据类型 | 来源 | 说明 |
|--------|---------|------|------|
| ticker | str | 用户输入 | 股票代码 |
| company_name | str | 数据查询 | 公司名称 |
| market_type | str | 自动识别 | 市场类型 |
| market_report | str | 市场分析师 | 技术面报告 |
| fundamentals_report | str | 基本面分析师 | 基本面报告 |
| news_report | str | 新闻分析师 | 新闻报告 |
| sentiment_report | str | 社交媒体分析师 | 情绪报告 |
| bull_report | str | 看涨研究员 | 看涨研究 |
| bear_report | str | 看跌研究员 | 看跌研究 |
| investment_plan | str | 投资计划生成器 | 初步计划 |
| risk_debate_history | list[str] | 风险辩论层 | 辩论历史 |
| risk_assessment | str | 风险经理 | 风险评估 |
| final_decision | str | 交易员 | 最终决策 |
| debate_count | int | 系统计数 | 当前辩论轮数 |
| risk_discuss_count | int | 系统计数 | 当前风险讨论轮数 |

---

## 4. 数据源返回格式

### 4.1 市场行情数据

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| date | str | 交易日期 (YYYY-MM-DD) |
| open | float | 开盘价 |
| high | float | 最高价 |
| low | float | 最低价 |
| close | float | 收盘价 |
| volume | int | 成交量 |
| amount | float | 成交额 |
| change | float | 涨跌额 |
| pct_change | float | 涨跌幅 (%) |

### 4.2 技术指标数据

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| ma_5 | float | 5日均线 |
| ma_10 | float | 10日均线 |
| ma_20 | float | 20日均线 |
| ma_60 | float | 60日均线 |
| rsi_14 | float | 14日RSI |
| macd | float | MACD值 |
| macd_signal | float | MACD信号线 |
| macd_histogram | float | MACD柱状图 |
| boll_upper | float | 布林带上轨 |
| boll_middle | float | 布林带中轨 |
| boll_lower | float | 布林带下轨 |

### 4.3 基本面数据

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| pe_ratio | float | 市盈率 |
| pb_ratio | float | 市净率 |
| ps_ratio | float | 市销率 |
| roe | float | 净资产收益率 (%) |
| roa | float | 总资产收益率 (%) |
| gross_margin | float | 毛利率 (%) |
| net_margin | float | 净利率 (%) |
| debt_ratio | float | 资产负债率 (%) |
| current_ratio | float | 流动比率 |
| revenue | float | 营业收入 |
| net_income | float | 净利润 |
| revenue_growth | float | 营收增长率 (%) |
| profit_growth | float | 利润增长率 (%) |
| market_cap | float | 总市值 |

### 4.4 新闻数据

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| title | str | 新闻标题 |
| content | str | 新闻内容摘要 |
| source | str | 新闻来源 |
| publish_time | str | 发布时间 |
| url | str | 新闻链接 |
| sentiment | str | 情感倾向：positive/negative/neutral |
| relevance | float | 相关度 (0.0-1.0) |

### 4.5 情绪数据

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| overall_sentiment | float | 综合情绪分 (-1.0 到 1.0) |
| bullish_ratio | float | 看涨比例 (%) |
| bearish_ratio | float | 看跌比例 (%) |
| discussion_volume | int | 讨论量 |
| hot_topics | list[str] | 热门话题 |
| data_source | str | 数据来源 |

---

## 5. 配置项字典

### 5.1 系统默认配置

| 配置项 | 数据类型 | 默认值 | 可选值 | 说明 |
|--------|---------|--------|--------|------|
| llm_provider | str | "openai" | openai/deepseek/google/dashscope | LLM提供商 |
| deep_think_llm | str | "o4-mini" | 各提供商支持的模型 | 深度思考模型 |
| quick_think_llm | str | "gpt-4o-mini" | 各提供商支持的模型 | 快速思考模型 |
| max_debate_rounds | int | 1 | 1-5 | 辩论最大轮数 |
| max_risk_discuss_rounds | int | 1 | 1-5 | 风险讨论最大轮数 |
| max_recur_limit | int | 100 | 50-200 | LangGraph最大递归 |
| online_tools | bool | false | true/false | 在线工具开关 |
| online_news | bool | true | true/false | 在线新闻开关 |
| realtime_data | bool | false | true/false | 实时数据开关 |
| default_china_data_source | str | "akshare" | tushare/akshare/baostock | 默认A股数据源 |

### 5.2 环境变量配置

| 变量名 | 必填 | 说明 |
|--------|------|------|
| MONGODB_HOST | 是 | MongoDB主机地址 |
| MONGODB_PORT | 是 | MongoDB端口 |
| MONGODB_USERNAME | 是 | MongoDB用户名 |
| MONGODB_PASSWORD | 是 | MongoDB密码 |
| REDIS_HOST | 是 | Redis主机地址 |
| REDIS_PORT | 是 | Redis端口 |
| REDIS_PASSWORD | 否 | Redis密码 |
| JWT_SECRET | 是 | JWT签名密钥 |
| JWT_ALGORITHM | 否 | JWT算法 (默认HS256) |
| DEEPSEEK_API_KEY | 否 | DeepSeek API密钥 |
| OPENAI_API_KEY | 否 | OpenAI API密钥 |
| GOOGLE_API_KEY | 否 | Google AI API密钥 |
| DASHSCOPE_API_KEY | 否 | 阿里百炼API密钥 |
| TUSHARE_TOKEN | 否 | Tushare数据令牌 |
| FINNHUB_API_KEY | 否 | FinnHub API密钥 |

---

## 6. 枚举值定义

### 6.1 市场类型

| 值 | 说明 |
|-----|------|
| A股 | 中国大陆股票市场（上海/深圳） |
| 港股 | 香港股票市场 |
| 美股 | 美国股票市场 |

### 6.2 分析任务状态

| 值 | 说明 |
|-----|------|
| pending | 等待执行 |
| running | 正在分析 |
| completed | 分析完成 |
| failed | 分析失败 |
| cancelled | 已取消 |

### 6.3 投资建议

| 值 | 说明 |
|-----|------|
| 买入 | 建议买入 |
| 持有 | 建议持有 |
| 卖出 | 建议卖出 |

### 6.4 LLM 提供商

| 值 | 说明 |
|-----|------|
| openai | OpenAI (GPT系列) |
| deepseek | DeepSeek (V3) |
| google | Google (Gemini系列) |
| dashscope | 阿里百炼 (通义千问系列) |
| anthropic | Anthropic (Claude系列) |
| 302ai | 302.AI 聚合渠道 |
| openrouter | OpenRouter 聚合渠道 |
| oneapi | One API 聚合渠道 |

### 6.5 数据深度级别

| 值 | 说明 | 数据量 |
|-----|------|--------|
| basic | 基础 | 近1个月 |
| 1m | 1个月 | 近30天 |
| 3m | 3个月 | 近90天 |
| 6m | 6个月 | 近180天 |
| 1y | 1年 | 近365天 |
| 3y | 3年 | 近1095天 |
| 5y | 5年 | 近1825天 |
