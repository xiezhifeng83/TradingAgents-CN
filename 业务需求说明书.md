# TradingAgents-CN 业务需求说明书

> **文档版本**: v1.0
> **项目版本**: v1.0.0-preview
> **编制日期**: 2026-02-11

---

## 1. 引言

### 1.1 文档目的

本文档详细描述 TradingAgents-CN 多智能体股票分析学习平台的业务需求，为项目开发、测试和验收提供统一的需求基线。

### 1.2 项目背景

在金融投资领域，投资决策需要综合考虑技术面、基本面、新闻面和市场情绪等多个维度。传统的单一分析方法往往存在片面性。TradingAgents-CN 通过多智能体协作机制，模拟专业投资团队的决策流程，为用户提供全面、客观的股票分析服务。

### 1.3 术语定义

| 术语 | 定义 |
|------|------|
| 智能体（Agent） | 由 LLM 驱动的、具有特定分析职责的 AI 实体 |
| LLM | 大语言模型 (Large Language Model) |
| 传播（Propagation） | 多智能体按工作流依次执行分析的过程 |
| 反思（Reflection） | 智能体回顾历史分析记忆以改进决策的过程 |
| 辩论（Debate） | 不同立场的智能体针对同一问题进行论证的过程 |
| 数据深度（Depth） | 获取历史数据的时间范围层级 |

---

## 2. 业务目标

### 2.1 总体目标

构建一个多智能体协作的股票分析学习平台，支持多市场、多数据源、多LLM引擎，提供从数据采集到投资建议的端到端分析服务。

### 2.2 具体目标

| 编号 | 目标 | 度量标准 |
|------|------|---------|
| G-01 | 支持 A股、港股、美股三大市场 | 覆盖主流交易所 |
| G-02 | 多维度分析（技术面/基本面/新闻/情绪） | 4个分析维度全覆盖 |
| G-03 | 多智能体辩论式决策 | 至少2轮多视角辩论 |
| G-04 | 多LLM引擎灵活切换 | 支持 8+ 个LLM提供商 |
| G-05 | 提供 Web/CLI 两种交互方式 | 覆盖开发者和终端用户 |
| G-06 | 分析结果可导出为报告 | 支持 Markdown/Word/PDF |

---

## 3. 用户角色

### 3.1 角色定义

| 角色 | 描述 | 关键需求 |
|------|------|---------|
| **终端用户** | 使用 Web 界面进行股票分析的投资学习者 | 简单易用、结果直观、报告可导出 |
| **开发者用户** | 使用 CLI 或 API 进行股票分析的技术人员 | 命令行操作、API调用、框架扩展 |
| **系统管理员** | 负责平台部署、配置和运维 | 容器化部署、配置管理、日志监控 |

---

## 4. 功能需求

### 4.1 核心分析功能

#### FR-01 单股分析

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-01 |
| **优先级** | P0（必须） |
| **描述** | 用户输入股票代码，系统执行多智能体分析流程，输出投资建议 |

**详细要求**：
1. 支持输入股票代码（如 `600036`、`00700.HK`、`AAPL`）
2. 自动识别股票所属市场（A股/港股/美股）
3. 并行启动四个分析师智能体采集和分析数据
4. 看涨/看跌研究员对分析结果进行辩证研究
5. 风险管理团队（保守/中立/激进三派）进行风险评估辩论
6. 交易员综合所有意见输出最终投资建议
7. 投资建议包含：操作方向（买入/持有/卖出）、置信度、目标价位、风险提示

**验收标准**：
- 输入有效股票代码后，5分钟内返回完整分析结果
- 分析结果包含四个维度（技术面/基本面/新闻/情绪）的报告
- 最终决策包含明确的操作建议和理由

#### FR-02 批量分析

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-02 |
| **优先级** | P1（应该） |
| **描述** | 用户可同时提交多只股票进行分析 |

**详细要求**：
1. 支持批量输入多个股票代码
2. 按队列顺序执行分析任务
3. 提供任务进度的实时反馈
4. 支持任务取消

#### FR-03 历史分析查询

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-03 |
| **优先级** | P1 |
| **描述** | 用户可查看历史分析记录和结果 |

**详细要求**：
1. 按时间倒序展示历史分析列表
2. 支持按股票代码、日期筛选
3. 支持查看历史分析的完整报告
4. 保留分析时的中间过程数据

### 4.2 数据管理功能

#### FR-04 多源数据采集

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-04 |
| **优先级** | P0 |
| **描述** | 系统从多个数据源采集股票市场数据 |

**详细要求**：
1. A股数据源：Tushare、AKShare、BaoStock
2. 港股数据源：AKShare、YFinance、FinnHub
3. 美股数据源：YFinance、FinnHub、Alpha Vantage
4. 数据源自动降级：主数据源不可用时自动切换备选
5. 数据采集类型：
   - 市场行情（开高低收、成交量等）
   - 基本面数据（财务报表、估值指标等）
   - 新闻资讯（财经新闻、公司公告等）
   - 市场情绪（社交媒体讨论、情绪评分等）

#### FR-05 数据缓存

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-05 |
| **优先级** | P1 |
| **描述** | 系统对采集的数据进行多层缓存 |

**详细要求**：
1. Redis 热数据缓存（毫秒级响应）
2. MongoDB 持久化缓存
3. 本地文件系统兜底缓存
4. 缓存策略可配置（TTL、容量等）

#### FR-06 数据同步

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-06 |
| **优先级** | P1 |
| **描述** | 支持定时/手动同步股票基础数据 |

**详细要求**：
1. 支持 Tushare、AKShare、BaoStock 数据同步
2. 支持定时任务调度
3. 支持手动触发同步
4. 同步进度实时展示

### 4.3 智能体配置功能

#### FR-07 LLM 引擎配置

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-07 |
| **优先级** | P0 |
| **描述** | 用户可配置和切换 LLM 引擎 |

**详细要求**：
1. 支持配置多个 LLM 提供商（OpenAI、Google Gemini、DeepSeek、阿里百炼等）
2. 区分"深度思考模型"和"快速思考模型"
3. 支持 API Key 管理
4. 支持自定义 API 端点（Base URL）
5. 支持聚合渠道（302.AI、OpenRouter 等）

#### FR-08 分析参数配置

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-08 |
| **优先级** | P1 |
| **描述** | 用户可调整分析流程参数 |

**详细要求**：
1. 辩论轮数配置（`max_debate_rounds`）
2. 风险讨论轮数配置（`max_risk_discuss_rounds`）
3. 在线工具开关（`online_tools`）
4. 在线新闻开关（`online_news`）
5. 实时数据开关（`realtime_data`）
6. 数据源优先级配置

### 4.4 报告导出功能

#### FR-09 分析报告导出

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-09 |
| **优先级** | P1 |
| **描述** | 用户可将分析结果导出为多种格式的报告 |

**详细要求**：
1. Markdown 格式导出
2. Word (docx) 格式导出
3. PDF 格式导出
4. 报告包含完整的分析过程和结论

### 4.5 用户管理功能

#### FR-10 用户认证与权限

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-10 |
| **优先级** | P0 |
| **描述** | 系统提供用户认证和基本权限管理 |

**详细要求**：
1. 用户注册/登录
2. JWT Token 认证
3. 密码加密存储（bcrypt）
4. API 访问速率限制

### 4.6 股票筛选功能

#### FR-11 智能股票筛选

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-11 |
| **优先级** | P2（可选） |
| **描述** | 根据条件筛选符合要求的股票 |

**详细要求**：
1. 多维度筛选条件
2. 筛选结果排序
3. 支持保存筛选策略

### 4.7 模拟交易功能

#### FR-12 模拟交易

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-12 |
| **优先级** | P2 |
| **描述** | 基于分析结果进行模拟交易 |

**详细要求**：
1. 虚拟资金账户
2. 买入/卖出操作记录
3. 持仓和盈亏统计

### 4.8 实时通知功能

#### FR-13 实时消息推送

| 属性 | 说明 |
|------|------|
| **需求编号** | FR-13 |
| **优先级** | P1 |
| **描述** | 系统通过实时通道推送分析进度和结果 |

**详细要求**：
1. Server-Sent Events (SSE) 支持
2. WebSocket 通知支持
3. 分析进度实时更新
4. 任务完成通知

---

## 5. 非功能需求

### 5.1 性能需求

| 编号 | 需求 | 指标 |
|------|------|------|
| NFR-01 | 单股分析响应时间 | ≤5分钟（含LLM调用） |
| NFR-02 | Web页面加载时间 | ≤3秒 |
| NFR-03 | API响应时间（非分析） | ≤500ms |
| NFR-04 | 并发分析任务数 | ≥3个 |
| NFR-05 | 数据缓存命中率 | ≥80% |

### 5.2 可用性需求

| 编号 | 需求 | 指标 |
|------|------|------|
| NFR-06 | 系统可用性 | 99%（非交易时段维护除外） |
| NFR-07 | 数据源降级 | 主源故障后 <5秒 切换备源 |
| NFR-08 | 错误恢复 | 单次分析失败不影响系统整体 |

### 5.3 安全需求

| 编号 | 需求 | 说明 |
|------|------|------|
| NFR-09 | 密码存储 | bcrypt 哈希加密 |
| NFR-10 | API认证 | JWT Token 机制 |
| NFR-11 | 敏感配置 | 环境变量管理，不入版本库 |
| NFR-12 | 速率限制 | 防止API滥用 |
| NFR-13 | 操作审计 | 关键操作日志记录 |

### 5.4 可维护性需求

| 编号 | 需求 | 说明 |
|------|------|------|
| NFR-14 | 日志管理 | 统一日志格式，分级输出 |
| NFR-15 | 配置热更新 | 部分配置支持运行时修改 |
| NFR-16 | 模块化设计 | 核心模块可独立测试和替换 |

### 5.5 部署需求

| 编号 | 需求 | 说明 |
|------|------|------|
| NFR-17 | 容器化部署 | Docker Compose 一键部署 |
| NFR-18 | 多架构支持 | amd64 + arm64 |
| NFR-19 | 环境隔离 | 开发/测试/生产环境配置隔离 |

---

## 6. 接口需求

### 6.1 外部接口

| 接口类型 | 对接方 | 协议 | 说明 |
|---------|--------|------|------|
| LLM API | OpenAI/DeepSeek/Google等 | HTTPS (REST) | 大语言模型推理服务 |
| 数据源 API | Tushare/AKShare/YFinance等 | HTTPS/SDK | 金融数据获取 |
| 新闻 API | Google News/Reddit | HTTPS | 新闻和社交媒体数据 |

### 6.2 内部接口

| 接口类型 | 说明 |
|---------|------|
| RESTful API | 前后端交互主通道 |
| WebSocket | 实时通知推送 |
| SSE | 分析进度流推送 |

---

## 7. 数据需求

### 7.1 数据存储

| 数据类型 | 存储方式 | 说明 |
|---------|---------|------|
| 用户数据 | MongoDB | 账户、偏好、权限 |
| 分析结果 | MongoDB | 历史分析记录与报告 |
| 股票基础数据 | MongoDB | 股票列表、基本信息 |
| 行情缓存 | Redis + MongoDB | 市场数据缓存 |
| 系统配置 | MongoDB + 环境变量 | LLM配置、数据源配置 |
| 操作日志 | MongoDB | 审计日志 |

### 7.2 数据备份

- MongoDB 数据卷持久化（Docker Volume）
- Redis 数据持久化（RDB/AOF）

---

## 8. 约束条件

### 8.1 技术约束

1. LLM 调用受 API 速率限制和费用约束
2. 部分数据源（如 Tushare）需要付费 Token
3. A股数据受交易时间限制（工作日 9:30-15:00）
4. 新闻数据可能受网络环境影响

### 8.2 业务约束

1. **免责声明**：系统分析结果仅供学习参考，不构成投资建议
2. **数据合规**：需遵守各数据源的使用条款
3. **许可合规**：Web应用部分为专有代码，商用需授权

---

## 9. 需求追踪矩阵

| 需求编号 | 需求名称 | 优先级 | 实现模块 | 状态 |
|---------|---------|--------|---------|------|
| FR-01 | 单股分析 | P0 | tradingagents/graph/, app/routers/analysis.py | 已实现 |
| FR-02 | 批量分析 | P1 | app/routers/analysis.py, app/services/queue_service.py | 已实现 |
| FR-03 | 历史分析查询 | P1 | app/routers/analysis.py | 已实现 |
| FR-04 | 多源数据采集 | P0 | tradingagents/dataflows/ | 已实现 |
| FR-05 | 数据缓存 | P1 | tradingagents/dataflows/cache/ | 已实现 |
| FR-06 | 数据同步 | P1 | app/worker/, app/routers/stock_sync.py | 已实现 |
| FR-07 | LLM引擎配置 | P0 | app/routers/config.py, tradingagents/config/ | 已实现 |
| FR-08 | 分析参数配置 | P1 | tradingagents/default_config.py | 已实现 |
| FR-09 | 报告导出 | P1 | app/routers/reports.py | 已实现 |
| FR-10 | 用户认证 | P0 | app/routers/auth_db.py | 已实现 |
| FR-11 | 股票筛选 | P2 | app/routers/screening.py | 已实现 |
| FR-12 | 模拟交易 | P2 | app/routers/paper.py | 已实现 |
| FR-13 | 实时通知 | P1 | app/routers/sse.py, websocket_notifications.py | 已实现 |
